# 📞 店舗電話番号検索アプリ

Streamlitを使用したExcelファイルの店舗名から電話番号を自動検索するアプリケーションです。

## 機能

- Excelファイルのアップロード
- 「架電リスト」シートのA列（店舗名）、C列（都道府県）を自動読み取り
- **検索手法**：「店舗名 + 都道府県 + 電話番号」でSerpAPIを使用して検索
- 検索結果をK列（店舗番号）に自動記入
- **K列に既にデータがある行はスキップ**（既存データ保護）
- **検索結果のプレビュー表示**（店舗名、都道府県、電話番号）
- **統計情報表示**（検索件数、スキップ件数）
- **元ファイルのフォーマット保持**（書式、他のシートもそのまま維持）
- 処理済みExcelファイルのダウンロード

## セットアップ

### 1. 必要なパッケージのインストール

```bash
pip install -r requirements.txt
```

### 2. SerpAPIキーの取得

1. [SerpAPI](https://serpapi.com/)にアクセス
2. アカウントを作成（無料プランあり）
3. APIキーを取得

### 3. 環境変数の設定

プロジェクトのルートディレクトリに`.env`ファイルを作成し、以下の内容を記載してください：

```
SERPAPI_KEY=あなたのAPIキー
```

`.env.example`ファイルをコピーして`.env`にリネームすることもできます：

```bash
# Windows (PowerShell)
Copy-Item .env.example .env

# Mac/Linux
cp .env.example .env
```

その後、`.env`ファイルを開いて`your_serpapi_key_here`を実際のAPIキーに置き換えてください。

## 使用方法

### アプリケーションの起動

```bash
streamlit run app.py
```

ブラウザが自動的に開き、アプリケーションが表示されます。

### Excelファイルの準備

アップロードするExcelファイルは以下の形式である必要があります：

- シート名：**架電リスト**
- A列：**店舗名**（検索対象の店舗名が入力されている）
- C列：**都道府県**（都道府県名が入力されている - より正確な検索のため）
- K列：**店舗番号**（電話番号が記入される列）

例：
| A列（店舗名） | B列 | C列（都道府県） | ... | K列（店舗番号） |
|--------------|-----|----------------|-----|----------------|
| スターバックス 渋谷店 | ... | 東京都 | ... | （検索結果が入る） |
| マクドナルド 新宿店 | ... | 東京都 | ... | （検索結果が入る） |

**検索クエリ例**：「スターバックス 渋谷店 東京都 電話番号」

### 操作手順

1. **ファイルをアップロード**：Excelファイルをドラッグ&ドロップまたは選択
2. **元データプレビュー確認**：アップロードしたファイルの最初の5行が表示されます
3. **検索実行**：「電話番号を検索」ボタンをクリック
4. **進捗確認**：プログレスバーで処理状況を確認（検索件数とスキップ件数が表示されます）
5. **結果プレビュー確認**：
   - 統計情報（検索実行件数、スキップ件数、合計）
   - 検索結果プレビュー（店舗名、都道府県、電話番号の20件まで表示）
6. **ダウンロード**：「処理済みExcelファイルをダウンロード」ボタンから結果を取得

**重要な特徴**：
- 元のExcelファイルのフォーマット（セルの書式、列幅など）が保持されます
- 他のシート（「架電リスト」以外）もそのまま残ります
- K列のデータのみが更新されます

## 注意事項

- SerpAPIの無料プランには月あたりの検索回数制限があります（通常100回/月）
- 店舗名や都道府県が正確でない場合、正しい電話番号が取得できない可能性があります
- 検索結果が見つからない場合、「見つかりませんでした」と表示されます
- K列に既にデータがある行は自動的にスキップされます（重複検索を防止）
- インターネット接続が必要です
- 元のExcelファイルは変更されません（新しいファイルとしてダウンロードされます）

## トラブルシューティング

### APIキー未設定エラー

```
⚠️ SerpAPIキーが設定されていません
```

→ `.env`ファイルが正しく作成され、有効なAPIキーが設定されているか確認してください。

### シートが見つからないエラー

```
「架電リスト」シートが見つかりません
```

→ Excelファイルに「架電リスト」という名前のシートがあるか確認してください。

### 検索エラー

```
エラー: ...
```

→ インターネット接続を確認し、APIキーが有効か確認してください。

## 技術スタック

- **Streamlit**: Webアプリケーションフレームワーク
- **Pandas**: データ処理
- **OpenPyXL**: Excel読み書き
- **SerpAPI**: Google検索API
- **python-dotenv**: 環境変数管理

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## サポート

問題が発生した場合は、Issueを作成してください。


